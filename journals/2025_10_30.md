## CentOS安装Docker并供普通用户使用
collapsed:: true
	- ((66330953-30ba-4733-b613-5ba891d66493))
- 系统：Centos 7.5.1804，Linux内核版本3.10.0-862.el7.x86_64
- #+BEGIN_NOTE
  在线安装
  #+END_NOTE
- 下载yum文件并替换为清华源 [docker实战centos 7.4 安装docker-CSDN博客](https://blog.csdn.net/chezhang8929/article/details/100794541)
  logseq.order-list-type:: number
- 执行`yum install -y docker-ce`安装社区版
  logseq.order-list-type:: number
- 更换Docker源 [docker实战centos 7.4 安装docker-CSDN博客](https://blog.csdn.net/chezhang8929/article/details/100794541)
  logseq.order-list-type:: number
  ``` bash
  mkdir /etc/docker
  vim /etc/docker/daemon.json
  添加以下内容
  {
      "registry-mirrors":["https://registry.docker-cn.com"]
  }
  ```
- 执行`systemctl start docker.service`启动进程，执行`docker version`查看版本 [docker实战centos 7.4 安装docker-CSDN博客](https://blog.csdn.net/chezhang8929/article/details/100794541)
  logseq.order-list-type:: number
- #+BEGIN_NOTE
  二进制离线安装
  #+END_NOTE
- 从[docker官方](https://download.docker.com/linux/static/stable/x86_64/)下载离线安装包，本文使用docker-20.10.24.tgz
  logseq.order-list-type:: number
- 解压并**复制**到usr/bin/，使用移动命令（mv）会导致启动Docker服务时卡住 [内网环境下离线安装Docker - sowler - 博客园](https://www.cnblogs.com/sowler/p/18228732)
  logseq.order-list-type:: number
  ``` bash
  tar -zxvf 安装包路径
  cp docker/* /usr/bin/
  ```
- 使用vim编辑`/etc/systemd/system/docker.service`文件 [内网环境下离线安装Docker - sowler - 博客园](https://www.cnblogs.com/sowler/p/18228732)
  logseq.order-list-type:: number
  ``` bash
  [Unit]
  Description=Docker Application Container Engine
  Documentation=https://docs.docker.com
  After=network-online.target firewalld.service
  Wants=network-online.target
  
  [Service]
  Type=notify
  # the default is not to use systemd for cgroups because the delegate issues still
  # exists and systemd currently does not support the cgroup feature set required
  # for containers run by docker
  ExecStart=/usr/bin/dockerd -H unix:///var/run/docker.sock --selinux-enabled=false --default-ulimit nofile=65536:65536
  ExecReload=/bin/kill -s HUP $MAINPID
  # Having non-zero Limit*s causes performance problems due to accounting overhead
  # in the kernel. We recommend using cgroups to do container-local accounting.
  LimitNOFILE=infinity
  LimitNPROC=infinity
  LimitCORE=infinity
  # Uncomment TasksMax if your systemd version supports it.
  # Only systemd 226 and above support this version.
  #TasksMax=infinity
  TimeoutStartSec=0
  # set delegate yes so that systemd does not reset the cgroups of docker containers Delegate=yes
  # kill only the docker process, not all processes in the cgroup KillMode=process
  # restart the docker process if it exits prematurely
  Restart=on-failure
  StartLimitBurst=3
  StartLimitInterval=60s
  
  [Install]
  WantedBy=multi-user.target
  ```
- 执行`mkdir -p /etc/docker`创建文件夹并编辑`/etc/docker/daemon.json`文件，更换国内源。**这里不能用\#添加注释。** [内网环境下离线安装Docker - sowler - 博客园](https://www.cnblogs.com/sowler/p/18228732), [CentOS7.6离线安装Docker - WilliamZheng - 博客园](https://www.cnblogs.com/williamzheng/p/18094590)
  logseq.order-list-type:: number
  ``` bash
  {
      "max-concurrent-downloads": 10,
      "max-concurrent-uploads": 10,
      "log-driver": "json-file",
      "log-opts": {"max-size":"1g", "max-file":"3"},
      "live-restore": true,
      "registry-mirrors": [
          "https://docker.1ms.run",
          "https://docker-0.unsee.tech",
          "https://docker.m.daocloud.io"
      ]
  }
  ```
- 执行以下命令启用配置文件、设置开机自启动并启动Docker [内网环境下离线安装Docker - sowler - 博客园](https://www.cnblogs.com/sowler/p/18228732)
  logseq.order-list-type:: number
  ``` bash
  chmod +x /etc/systemd/system/docker.service
  systemctl daemon-reload
  systemctl enable docker
  systemctl start docker
  ```
- 授权普通用户使用Docker [Docker中授权普通用户使用docker命令以及解决无权限访问/var/run/docker.sock错误_linux用户无docker权限-CSDN博客](https://blog.csdn.net/listhi520/article/details/153514514)
  logseq.order-list-type:: number
  ``` bash
  groupadd docker
  usermod -aG docker 用户名
  systemctl restart docker
  ```
- #+BEGIN_NOTE
  rpm离线安装
  #+END_NOTE
- 依赖较复杂 [centos 7下离线安装docker - 知乎](https://zhuanlan.zhihu.com/p/349055854)
  logseq.order-list-type:: number