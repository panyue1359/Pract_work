## MicroSim GUI run按钮报错
id:: 69493361-687e-4c02-8602-804874da19b3
collapsed:: true
	- ((64465741-07d5-4238-a48f-8dbc8cba938d))
		- >参考
			- ((69469f50-4a53-4007-ab9a-7a9577370665))
- 详情：下载[官方仓库发行版 MicroSim-5.0](https://github.com/ICME-India/MicroSim/releases/tag/v5.0) 压缩包，使用Singularity生成基于miniconda环境的sif镜像，最后一步生成新的Input.in和Filling.in文件后，点击run按钮，弹出gnome-terminal窗口，提示找不到一些东西。查看`\resources\functions`目录下的Linux.py和windows.py文件，发现文件路径为提前写好的字符串，推测这个按钮当初应该只是用于演示。
	- 查看仓库“main”分支下的对应文件，发现已修改
	- 下载仓库的“main”分支
- 提示找到不tinydb库，发现弹出的gnome-terminal窗口无法自动切换到msenv虚拟环境，所以找不到。
	- 在沙箱中修改~/.bashrc，在`# <<< conda initialize <<<`下增加一行`conda activate msenv`，然后执行`grep -v -E "(密码|secret|key|敏感信息)" /root/.bashrc | tee /etc/shared_bashrc`将~/.bashrc复制到/etc/shared_bashrc，执行`chmod 644 /etc/shared_bashrc`修改此文件权限为所有人可读取（644）
	  logseq.order-list-type:: number
	- 方案一：
	  logseq.order-list-type:: number
		- 退出容器，执行`cp ~/.bashrc ~/.bashrcbk`备份原来的.bashrc
		  logseq.order-list-type:: number
		- 第一次进入容器，执行`ln -sf /etc/shared_bashrc ~/.bashrc`将上述文件链接到普通用户的.bashrc文件上，这个设置是永久的
		  logseq.order-list-type:: number
		- 后续进入宿主系统时会发现用户名改变，环境变量丢失，可执行 `rm ~/.bashrc; cp ~/.bashrcbk ~/.bashrc; source ~/.bashrc`恢复并激活
		  logseq.order-list-type:: number
	- 方案二：
	  logseq.order-list-type:: number
		- 修改`\resources\functions`目录下的Linux.py文件，在`def SolverExecute(self):`函数下添加`sourceLine = "source /etc/shared_bashrc;"`，然后将sourceLine追加到每个判断分支的commandLine之前
		  logseq.order-list-type:: number
		- 每次进入容器后执行`source /etc/shared_bashrc`
		  logseq.order-list-type:: number
- 提示`ValueError: numpy.dtype size changed, may indicate binary incompatibility. Expected 96 from C header, got 88 from PyObject`，上网搜索发现是numpy版本不对
	- 在沙箱中卸载原来的numpy（2.0.2），安装1.24.0版本
- 提示找不到h5pcc
	- 提前下载hdf5-1_12_2.tar.gz、gsl-latest.tar.gz和fftw-3.3.8.tar.gz压缩包，复制到沙箱的`/opt`文件夹下
	- 在沙箱中执行以下命令编译hdf5、gsl和fftw3压缩包
	  ``` bash
	  ## HDF5 安装（并行 HDF5，使用 mpicc）
	  echo "安装 HDF5..."
	  mkdir -p /opt/HDF5_build
	  if [ -f /opt/hdf5-1_12_2.tar.gz ]; then
	      tar xzf /opt/hdf5-1_12_2.tar.gz -C /opt/HDF5_build
	  else
	      echo "警告: hdf5-1_12_2.tar.gz 未找到"
	  fi
	  HDF5_SRC_DIR=$(find /opt/HDF5_build -maxdepth 1 -type d -name "hdf5*" -print -quit || true)
	  if [ -z "$HDF5_SRC_DIR" ]; then
	      HDF5_SRC_DIR=/opt/HDF5_build/hdf5-hdf5-1_12_2
	  fi
	  if [ -d "$HDF5_SRC_DIR" ]; then
	      cd "$HDF5_SRC_DIR"
	      CC=${CC:-mpicc} ./configure --prefix=/opt/HDF5-1.12.2 --enable-parallel
	      make -j$(nproc)
	      make install
	      chmod -R 755 /opt/HDF5-1.12.2
	  else
	      echo "错误: 未找到 HDF5 源目录 ($HDF5_SRC_DIR)"
	  fi
	  # 将hdf5写入环境变量
	  echo 'export PATH="/opt/HDF5-1.12.2/bin:$PATH"' >> ~/.bashrc
	  source ~/.bashrc
	  ## GSL 安装
	  echo "安装 GSL..."
	  cd /opt
	  if [ -f /opt/gsl-latest.tar.gz ]; then
	      tar xzf /opt/gsl-latest.tar.gz
	      GSL_SRC_DIR=$(find /opt -maxdepth 1 -type d -name "gsl-*" -print -quit || true)
	      if [ -n "$GSL_SRC_DIR" ]; then
	          cd "$GSL_SRC_DIR"
	          ./configure
	          make -j$(nproc)
	          make install
	      else
	          echo "警告: 未能找到解包后的 GSL 目录"
	      fi
	  else
	      echo "警告: gsl-latest.tar.gz 未找到"
	  fi
	  ## FFTW3 安装
	  echo "安装 FFTW3..."
	  if [ -f /opt/fftw-3.3.8.tar.gz ]; then
	      tar xzf /opt/fftw-3.3.8.tar.gz -C /opt
	      if [ -d /opt/fftw-3.3.8 ]; then
	          cd /opt/fftw-3.3.8
	          ./configure
	          make -j$(nproc)
	          make install
	      else
	          echo "警告: fftw-3.3.8 源目录未找到"
	      fi
	  else
	      echo "警告: fftw-3.3.8.tar.gz 未找到"
	  fi
	  # 清理临时构建目录与 apt 缓存，保留 tarballs 以便调试/二次使用。
	  echo "清理临时文件..."
	  rm -rf /opt/ompi_build /opt/HDF5_build /var/lib/apt/lists/*
	  # 移除所有 /opt 下的 tar.gz
	  rm -f /opt/*.tar.gz
	  ```
- 点击“h5 to vkt”按钮没反应
	- 根据说明“MicroSim_Installation_GUI_Infile_generator_post-processing_tool.pdf”，解压 ParaView 5.10.1 到/opt文件夹，添加环境变量
	- 执行`apt-get install libcurl4`安装libcurl4，否则ParaView无法打开
- 点击“Preview in ParaView”按钮没反应
	- 修改`\resources\functions`目录下的Linux.py文件，将`def paraviewFunc(self):`下的ParaView目录改写为`/opt/ParaView-5.10.1-MPI-Linux-Python3.9-x86_64/bin/paraview`