## OpenFOAM singularity 集群多节点并行计算
collapsed:: true
	- 别名: singularity container hpc nodes parallel computing
	- ((66330953-30ba-4733-b613-5ba891d66493)), ((6920303d-008c-421a-9bae-d436739cb759))
- 系统：CentOS 7.5.1804，Linux内核版本3.10.0-862.el7.x86_64
- 作业调度系统：Torque 4.2.10
- 这里 [howto:openfoam [wiki.chpc.ac.za]](https://wiki.chpc.ac.za/howto:openfoam#running_openfoam) 给出了一个适用于PBSPro的OpenFOAM并行计算脚本
- 执行`qsub -I -V -l nodes=2`申请两个计算节点，使用`-V`加载登录节点的singularity路径，登录后只显示头节点名称，执行`echo $PBS_NODEFILE`可查看分配的全部节点
- 思路一：使用登录节点安装的mpirun并行运行singularity容器中的OpenFOAM求解器，执行`mpirun -np 96 -x PATH -x LD_LIBRARY_PATH -host node14:48,node16:48 singularity run OpenFOAM容器路径 求解器名称 -parallel > log.foamOut`，报错“OPAL ERROR: Unreachable in file ext3x_client.c at line 111”
	- 不加`-x PATH -x LIBRARY_PATH`会提示找不到mpirun
	- 可使用Torque参数`-np $NP -machinefile $PBS_NODEFILE`指定核数和计算节点
- 思路二：进入容器，使用容器内的mpirun并行运行OpenFOAM求解器，报错“ORTE was unable to reliably start one or more daemons.”
	- 如果只在头节点并行计算则没有问题，当要求核数超过头节点后也不会报错，但计算速度变慢，应该是只使用了头节点计算