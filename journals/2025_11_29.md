## CentOS安装Singularity并供普通用户使用
collapsed:: true
	- ((69202eab-d4f0-48e6-8c09-9ddb00b57ab6))
	  collapsed:: true
		- collapsed:: true
		  >参考
			- ((69196474-7346-484d-813c-cb86a6a75067))
			- ((65b71758-6da2-4f16-b6ea-37dcd98bbda5))
- 系统：CentOS 7.5.1804，Linux内核版本3.10.0-862.el7.x86_64
- #+BEGIN_PINNED
  使用conda安装
  #+END_PINNED
- 使用x-cmd安装miniconda模块，详见“X-CMD简介”条目
- 创建conda虚拟环境，并使用conda-forge通道安装singularityce包（singularity包已停更，singularityce最新可用版为3.9.5） [Singularity——生信流程搭建的幸运儿 - 知乎](https://zhuanlan.zhihu.com/p/608539647), [python - Conda takes 20+ minutes to solve environment when package is already installed - Stack Overflow](https://stackoverflow.com/questions/53250933/conda-takes-20-minutes-to-solve-environment-when-package-is-already-installed)
  ```bash
  conda create -n sing
  conda activate sing
  conda search singularityce --channel conda-forge
  conda install -c conda-forge -c defaults singularityce=3.9.5
  ```
- 第四步会显示两次retrying，需要等待很长时间，可以尝试换国内源，详见条目“Anaconda更换镜像源”
- #+BEGIN_PINNED
  离线安装rpm包
  #+END_PINNED
- 从官方仓库下载rpm包，当前Linux内核版本为el7，最高可下载4.1.4，本文使用3.9.9，因为依赖包较少 [Releases · sylabs/singularity](https://github.com/sylabs/singularity/releases?page=4)
  logseq.order-list-type:: number
- 根据3.9.9的发布声明，下载[go1.17.9](https://dl.google.com/go/go1.17.9.linux-amd64.tar.gz)，执行以下命令解压并设置环境变量 [在CentOS7.4环境下安装Singularirty3.9 - 知乎](https://zhuanlan.zhihu.com/p/447934670)
  logseq.order-list-type:: number
  ``` bash
  sudo tar -C /usr/local -xzvf go1.17.9.linux-amd64.tar.gz && \
      rm go1.17.9.linux-amd64.tar.gz
  echo 'export GOPATH=${HOME}/go' >> ~/.bashrc && \
      echo 'export PATH=/usr/local/go/bin:${PATH}:${GOPATH}/bin' >> ~/.bashrc && \
      source ~/.bashrc
  ```
- 执行以下命令使用rpm包安装singularity
  logseq.order-list-type:: number
  ``` bash
  yum install singularity-ce-3.9.9.tar.gz
  ```
- 启用命名空间以允许fakeroot功能 [在CentOS7.4环境下安装Singularirty3.9 - 知乎](https://zhuanlan.zhihu.com/p/447934670)
  logseq.order-list-type:: number
  ``` bash
  echo user.max_user_namespaces=15000 >/etc/sysctl.d/90-max_net_namespaces.conf
  sysctl -p /etc/sysctl.d /etc/sysctl.d/90-max_net_namespaces.conf
  ```
- 添加Singularity fakeroot用户
  logseq.order-list-type:: number
  ``` bash
  singularity config fakeroot --add 用户名
  ```
- 测试
  logseq.order-list-type:: number
  ``` bash
  singularity --version
  ```